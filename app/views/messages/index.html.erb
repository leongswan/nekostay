<div class="container" style="max-width: 600px;">
  
  <%# 1. ヘッダー %>
  <div class="card mb-4">
    <div class="stack stack--between">
      <h2 style="margin:0;">メッセージ</h2>
      <%= link_to "滞在詳細に戻る", stay_path(@stay), class: "btn btn--ghost" %>
    </div>
    <p class="meta mt-2">
      Stay: <%= @stay.start_on %> 〜 <%= @stay.end_on %><br>
      Pet: <%= @stay.pet&.name %>
    </p>
  </div>

  <%# 2. メッセージリスト (チャットエリア) %>
  <div class="messages-list" style="display: flex; flex-direction: column; gap: 12px; margin-bottom: 24px;">
    <% if @messages.empty? %>
      <div style="text-align: center; color: #888; padding: 20px;">
        まだメッセージはありません。<br>連絡事項があれば送信してみましょう！
      </div>
    <% else %>
      <% @messages.each do |msg| %>
        <%# 自分(current_user)のメッセージなら右寄せ、相手なら左寄せ %>
        <% is_me = (msg.sender_id == current_user.id) %>
        
        <div style="display: flex; justify-content: <%= is_me ? 'flex-end' : 'flex-start' %>;">
          <div style="
            max-width: 70%;
            padding: 10px 14px;
            border-radius: 12px;
            background-color: <%= is_me ? '#dcf8c6' : '#fff' %>; /* LINE風の色分け */
            border: 1px solid <%= is_me ? '#dcf8c6' : '#ddd' %>;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
          ">
            <div style="font-size: 14px; white-space: pre-wrap;"><%= msg.body %></div>
            <div style="font-size: 10px; color: #888; text-align: right; margin-top: 4px;">
              <%= msg.created_at.strftime("%m/%d %H:%M") %>
            </div>
          </div>
        </div>
      <% end %>
    <% end %>
  </div>

  <%# 3. 入力フォーム %>
  <div class="card">
    <%= form_with model: [@stay, @message], local: true do |f| %>
      <% if @message.errors.any? %>
        <div class="flash flash--alert mb-4">
          <%= @message.errors.full_messages.first %>
        </div>
      <% end %>

      <div class="form-group">
        <%= f.text_area :body, 
              rows: 3, 
              class: "textarea", 
              placeholder: "メッセージを入力...", 
              required: true,
              style: "width: 100%; box-sizing: border-box;" %>
      </div>
      
      <div class="stack stack--end mt-4">
        <%= f.submit "送信する", class: "btn btn--primary" %>
      </div>
    <% end %>
  </div>

</div>