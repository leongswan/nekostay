<%# 
  app/views/stays/_form.html.erb
  StaySplitter を動かすための最小限のフォーム
%>
<%= form_with model: stay, class: "card" do |f| %>

  <%# エラー表示 (もしあれば) %>
  <% if stay.errors.any? %>
    <div class="flash flash--alert">
      <strong><%= stay.errors.count %>件のエラー:</strong>
      <ul>
        <% stay.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="form-grid">
    <div>
      <%= f.label :pet_id, t(".pet") %>
      <%# 
        (注: Pet の選択肢を @pets から読み込みます) 
        (ステップ3でコントローラーを修正します)
      %>
      <%= f.collection_select :pet_id, @pets, :id, :name, 
            { prompt: "ペットを選択してください" }, 
            { class: "input" } %>
    </div>
    
    <div>
      <%= f.label :place, t(".place") %>
      <%# Stay モデルの enum (owner_home/sitter_home) から選択肢を作成 %>
      <%= f.select :place, 
            Stay.places.keys.map { |k| [t("enums.stay.place.#{k}"), k] }, 
            { prompt: "場所を選択してください" }, 
            { class: "input" } %>
    </div>

    <div>
      <%= f.label :start_on, t(".start_on") %>
      <%= f.date_field :start_on, class: "input" %>
    </div>
    
    <div>
      <%= f.label :end_on, t(".end_on") %>
      <%= f.date_field :end_on, class: "input" %>
    </div>
  </div>

  <div style="margin-top: 20px; background: #f0f0f0; padding: 15px; border-radius: 8px;">
    <%= f.label :sitter_id, "担当シッター (テスト用)", style: "display: block; font-weight: bold; margin-bottom: 5px; color: #5A4A42;" %>
    
    <%# 全ユーザーから名前で選べるようにします %>
    <%= f.collection_select :sitter_id, User.all, :id, :name, 
          { include_blank: "指名なし" }, 
          { style: "width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;" } %>
    
    <p style="font-size: 0.8rem; color: #d63031; margin-top: 5px;">
      ※ テストのために「自分」を選んで更新してください
    </p>
  </div>

  <div style="margin-top: 12px;">
    <%= f.label :notes, t(".notes") %>
    <%= f.text_area :notes, rows: 4, class: "textarea" %>
  </div>

  <div class="stack stack--end" style="margin-top: 16px;">
    <%= link_to t(".cancel"), stays_path, class: "btn" %>
    <%= f.submit t(".save"), class: "btn btn--primary" %>
  </div>
<% end %>